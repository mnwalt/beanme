<div class="container">
  <div class="page-header">
    <h2><%= @origin_country.name %> </h2>
  </div>

  <div class="row">
    <div class="col-md-12">
      <img src="<%= @origin_country.cover_photo_url %>" class="img-responsive left-block" style="max-height: 400px;">
      <br> </br>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <h3> Get to Know </h3>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12 mb-2">
      <dl class="dl-horizontal">

        <% if @origin_country.description != "" %>
        <dt>Low Down</dt>
        <dd><%= @origin_country.description %></dd>
        <% end %>

        <dt> Avg BeanMe Rating <dt>
          <% if @origin_country.reviews.count != 0 %>
          <dd>
            <% @n = @origin_country.reviews.pluck(:overall_rating).count %>
            <% @avg = @origin_country.reviews.pluck(:overall_rating).inject(0){|sum,x| sum + x } / @n %>

            <% if @avg < 0.75 %>
            <a>
              <span title="based on individual bean ratings">
                <i class="fa fa-star-half" aria-hidden="true"></i>
              </span>
              <small> (<%= @n %>) </small>
            </a>
            <% else %>
            <% if @avg < 1.25 %>
            <a>
              <span title="based on individual bean ratings">
                <i class="fa fa-star" aria-hidden="true"></i>
              </span>
              <small> (<%= @n %>) </small>
            </a>
            <% else %>
            <% if @avg < 1.75 %>
            <<a>
              <span title="based on individual bean ratings">
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star-half" aria-hidden="true"></i>
              </span>
              <small> (<%= @n %>) </small>
            </a>
            <% else %>
            <% if @avg < 2.25 %>
            <a>
              <span title="based on individual bean ratings">
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star" aria-hidden="true"></i>
              </span>
              <small> (<%= @n %>) </small>
            </a>
            <% else %>
            <% if @avg < 2.75 %>
            <a>
              <span title="based on individual bean ratings">
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star-half" aria-hidden="true"></i>
              </span>
              <small> (<%= @n %>) </small>
            </a>
            <% else %>
            <% if @avg < 3.25 %>
            <a>
              <span title="based on individual bean ratings">
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star" aria-hidden="true"></i>
              </span>
              <small> (<%= @n %>) </small>
            </a>
            <% else %>
            <% if @avg < 3.75 %>
            <a>
              <span title="based on individual bean ratings">
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star-half" aria-hidden="true"></i>
              </span>
              <small> (<%= @n %>) </small>
            </a>
            <% else %>
            <% if @avg < 4.25 %>
            <a>
              <span title="based on individual bean ratings">
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star" aria-hidden="true"></i>
              </span>
              <small> (<%= @n %>) </small>
            </a>
            <% else %>
            <% if @avg < 4.75 %>
            <a>
              <span title="based on individual bean ratings">
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star-half" aria-hidden="true"></i>
              </span>
              <small> (<%= @n %>) </small>
            </a>
            <% else %>
            <a>
              <span title="based on individual bean ratings">
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star" aria-hidden="true"></i>
                <i class="fa fa-star" aria-hidden="true"></i>
              </span>
              <small> (<%= @n %>) </small>
            </a>
            <% end %>
            <% end %>
            <% end %>
            <% end %>
            <% end %>
            <% end %>
            <% end %>
            <% end %>
            <% end %>
            <% else %>
            <dd>
              <a>
                <span title="not yet rated">
                  <i class="fa fa-star-o" aria-hidden="true"></i>
                </span>
              </a>
            </dd>
            <% end %>

            <dt> <%= current_user.username %>'s Avg Rating <dt>
              <% if @origin_country.reviews.where(:user_id => current_user).count != 0 %>
              <dd>
                <% @n = @origin_country.reviews.where(:user_id => current_user).pluck(:overall_rating).count %>
                <% @avg = @origin_country.reviews.where(:user_id => current_user).pluck(:overall_rating).inject(0){|sum,x| sum + x } / @n %>

                <% if @avg < 0.75 %>
                <a>
                  <span title="based on individual bean ratings">
                    <i class="fa fa-star-half" aria-hidden="true"></i>
                  </span>
                  <small> (<%= @n %>) </small>
                </a>
                <% else %>
                <% if @avg < 1.25 %>
                <a>
                  <span title="based on individual bean ratings">
                    <i class="fa fa-star" aria-hidden="true"></i>
                  </span>
                  <small> (<%= @n %>) </small>
                </a>
                <% else %>
                <% if @avg < 1.75 %>
                <<a>
                  <span title="based on individual bean ratings">
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star-half" aria-hidden="true"></i>
                  </span>
                  <small> (<%= @n %>) </small>
                </a>
                <% else %>
                <% if @avg < 2.25 %>
                <a>
                  <span title="based on individual bean ratings">
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                  </span>
                  <small> (<%= @n %>) </small>
                </a>
                <% else %>
                <% if @avg < 2.75 %>
                <a>
                  <span title="based on individual bean ratings">
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star-half" aria-hidden="true"></i>
                  </span>
                  <small> (<%= @n %>) </small>
                </a>
                <% else %>
                <% if @avg < 3.25 %>
                <a>
                  <span title="based on individual bean ratings">
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                  </span>
                  <small> (<%= @n %>) </small>
                </a>
                <% else %>
                <% if @avg < 3.75 %>
                <a>
                  <span title="based on individual bean ratings">
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star-half" aria-hidden="true"></i>
                  </span>
                  <small> (<%= @n %>) </small>
                </a>
                <% else %>
                <% if @avg < 4.25 %>
                <a>
                  <span title="based on individual bean ratings">
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                  </span>
                  <small> (<%= @n %>) </small>
                </a>
                <% else %>
                <% if @avg < 4.75 %>
                <a>
                  <span title="based on individual bean ratings">
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star-half" aria-hidden="true"></i>
                  </span>
                  <small> (<%= @n %>) </small>
                </a>
                <% else %>
                <a>
                  <span title="based on individual bean ratings">
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                  </span>
                  <small> (<%= @n %>) </small>
                </a>
                <% end %>
                <% end %>
                <% end %>
                <% end %>
                <% end %>
                <% end %>
                <% end %>
                <% end %>
                <% end %>
                <% else %>
                <dd>
                  <a>
                    <span title="not yet rated">
                      <i class="fa fa-star-o" aria-hidden="true"></i>
                    </span>
                  </a>
                </dd>
                <% end %>
              </dl>

            </div>
          </div>

          <div class="row">
            <div class="col-md-12">
              <h3> Beans </h3>
              <div class="table">
                <% @origin_country.beans.each do |bean| %>
                <div class="col-md-3">
                  <div class="panel panel-default" style="height: 515px;">
                    <div class="panel-body">
                      <a href="/beans/<%= bean.id %>">
                        <img src="<%= bean.image_url %>" class="img-responsive center-block" style="max-height: 150px;">
                      </a>
                      <hr>
                      <% if bean.name.length < 24 %>
                      <h4>
                        <a href="/beans/<%= bean.id %>"><%= bean.name %></a>
                        <br> </br>
                      </h4>
                      <% else %>
                      <h4>
                        <a href="/beans/<%= bean.id %>"><%= bean.name %></a>
                      </h4>
                      <% end %>
                      <% if bean.flavor_note_1.length < 36 %>
                      <h5> <%= bean.flavor_note_1 %>
                        <br> </br>
                      </h5>
                      <% else %>
                      <h5> <%= bean.flavor_note_1 %>
                      </h5>
                      <% end %>
                      <div class="row">
                        <% if bean.reviews.count == 0 %>
                        <a href="/beans/<%= bean.id %>" class="btn btn-link">
                          <span title="not yet rated">
                            <i class="fa fa-star-o" aria-hidden="true"></i>
                          </span>
                        </a>
                        <% else %>
                        <% @avg = Review.where(:bean_id => bean).pluck(:overall_rating).inject(0){|sum,x| sum + x } / Review.where(:bean_id => bean ).pluck(:overall_rating).count %>
                        <% @n = Review.where(:bean_id => bean ).pluck(:overall_rating).count %>
                        <% if @avg < 0.75 %>
                        <a href="/beans/<%= bean.id %>" class="btn btn-link">
                          <span title="rate bean">
                            <i class="fa fa-star-half" aria-hidden="true"></i>
                          </span>
                          <small> (<%= @n %>) </small>
                        </a>
                        <% else %>
                        <% if @avg < 1.25 %>
                        <a href="/beans/<%= bean.id %>" class="btn btn-link">
                          <span title="rate bean">
                            <i class="fa fa-star" aria-hidden="true"></i>
                          </span>
                          <small> (<%= @n %>) </small>
                        </a>
                        <% else %>
                        <% if @avg < 1.75 %>
                        <a href="/beans/<%= bean.id %>" class="btn btn-link">
                          <span title="rate bean">
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star-half" aria-hidden="true"></i>
                          </span>
                          <small> (<%= @n %>) </small>
                        </a>
                        <% else %>
                        <% if @avg < 2.25 %>
                        <a href="/beans/<%= bean.id %>" class="btn btn-link">
                          <span title="rate bean">
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star" aria-hidden="true"></i>
                          </span>
                          <small> (<%= @n %>) </small>
                        </a>
                        <% else %>
                        <% if @avg < 2.75 %>
                        <a href="/beans/<%= bean.id %>" class="btn btn-link">
                          <span title="rate bean">
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star-half" aria-hidden="true"></i>
                          </span>
                          <small> (<%= @n %>) </small>
                        </a>
                        <% else %>
                        <% if @avg < 3.25 %>
                        <a href="/beans/<%= bean.id %>" class="btn btn-link">
                          <span title="rate bean">
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star" aria-hidden="true"></i>
                          </span>
                          <small> (<%= @n %>) </small>
                        </a>
                        <% else %>
                        <% if @avg < 3.75 %>
                        <a href="/beans/<%= bean.id %>" class="btn btn-link">
                          <span title="rate bean">
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star-half" aria-hidden="true"></i>
                          </span>
                          <small> (<%= @n %>) </small>
                        </a>
                        <% else %>
                        <% if @avg < 4.25 %>
                        <a href="/beans/<%= bean.id %>" class="btn btn-link">
                          <span title="rate bean">
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star" aria-hidden="true"></i>
                          </span>
                          <small> (<%= @n %>) </small>
                        </a>
                        <% else %>
                        <% if @avg < 4.75 %>
                        <a href="/beans/<%= bean.id %>" class="btn btn-link">
                          <span title="rate bean">
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star-half" aria-hidden="true"></i>
                          </span>
                          <small> (<%= @n %>) </small>
                        </a>
                        <% else %>
                        <a href="/beans/<%= bean.id %>" class="btn btn-link">
                          <span title="rate bean">
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star" aria-hidden="true"></i>
                          </span>
                          <small> (<%= @n %>) </small>
                        </a>
                        <% end %>
                        <% end %>
                        <% end %>
                        <% end %>
                        <% end %>
                        <% end %>
                        <% end %>
                        <% end %>
                        <% end %>
                        <% end %>
                      </div>
                      <h5> $<%= bean.price_per_bag %> <small> per bag </small></h5>
                      <h6> <%= bean.bag_size_grams.to_i %>g / <%= (bean.bag_size_grams * 0.035274).round(1) %>oz </h6>
                      <h6> <small> ($<%= (bean.price_per_bag / (bean.bag_size_grams * 0.035274)).round(2)%> per oz) </small> </h6>
                      <div class="row">
                        <% if bean.labs.include?(current_user) == true %>
                        <a href="/delete_inventory/<%= bean.inventories.where(user_id: current_user.id).pluck(:id).to_sentence %>" class="btn btn-link">
                          <span title="remove favorite">
                            <i class="fa fa-heart" aria-hidden="true"></i>
                          </span>
                        </a>
                        <% else %>
                        <form action="/create_inventory" method="post">
                          <input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>">
                          <input type="hidden" name="bean_id" value="<%= bean.id %>">
                          <input type="hidden" name="user_id" value="<%= current_user.id %>">
                          <span title="make a favorite">
                            <button class="btn btn-link">
                              <i class="fa fa-heart-o" aria-hidden="true"></i>
                            </span>
                          </button>
                        </form>
                        <% end %>
                        <% if %>
                        <% bean.caffine == true %>
                        <span title="caffeinated">
                          <i class="fa fa-rocket" aria-hidden="true"></i>
                        </span>
                        <% end %>
                        <% if %>
                        <% bean.blend == true %>
                        <span title="blend">
                          <i class="fa fa-flask" aria-hidden="true"></i>
                        </span>
                        <% end %>
                        <% if %>
                        <% bean.espresso == true %>
                        <span title="espresso">
                          <i class="fa fa-coffee" aria-hidden="true"></i>
                        </span>
                        <% end %>
                      </div>
                    </div>
                  </div>
                </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
